<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>D3 Page Template</title>
    <script type="text/javascript" src="d3.js"></script>
    <style type="text/css">
        div.bar {
            display: inline-block;
            width: 20px;
            height: 75px;
            background-color: teal;
            margin-right: 2px;
        }
    </style>
</head>

<body>
    <p>Hello2</p>
    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz"></div>
    <script type="text/javascript">
        // set the dimensions and margins of the graph
        var margin = {
                top: 30,
                right: 30,
                bottom: 30,
                left: 30
            },
            width = 450 - margin.left - margin.right,
            height = 450 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Labels of row and columns
        var myXLabels = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]
        var myYLabels = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]

        // Build X scales and axis:
        var xScale = d3.scaleBand()
            .domain(myXLabels)
            .rangeRound([0, width])
            .paddingInner(0.05);
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale));

        // Build Y scales and axis:
        var yScale = d3.scaleBand()
            .domain(myYLabels)
            .rangeRound([height, 0])
            .paddingInner(0.05);
        svg.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(yScale));

        // Build color scale
        var myColor = d3.scaleLinear()
            .domain([0, 100])
            .range(["white", "#69b3a2"]);

        //Function for converting CSV values from strings to strings and numbers
        var rowConverter = function(d) {
            return {
                Xlabel: d.Xlabel,
                Ylabel: d.Ylabel,
                Value: parseInt(d.Value)
            };
        }

        // var rects = svg.append("g")
        //                 .attr("id", "rects")


        //Read the data
        d3.csv("confusion.csv", rowConverter).then(function(data) {
            console.log(data);

            //Copy data into global dataset
            dataset = data;

            console.log(svg);

            // svg.selectAll("rect")
            //        .data(dataset)
            //        .enter()
            //        .append("circle")

            // svg.selectAll("rect")
            //     .data(dataset)
            //     .enter()
            svg.selectAll()
                .data(dataset, function(d) {
                    return d.group + ':' + d.variable;
                })
                .enter()
                .append("rect")
                .attr("x", function(d, i) {
                    return xScale(d.Xlabel)
                })
                .attr("y", function(d, i) {
                    return yScale(d.Ylabel)
                })
                .attr("width", xScale.bandwidth())
                .attr("height", yScale.bandwidth())
                .style("fill", function(d) {
                    return myColor(d.Value)
                })
                .on("mouseover", handleMouseOver)
                .on("mouseout", handleMouseOut);
        })

        // Create Event Handlers for mouse
        function handleMouseOver(d, i) { // Add interactivity
            // Use D3 to select element
            d3.select(this)
                .style("stroke", "orange")
                .style("stroke-width", 3);

            // // Specify where to put label of text
            // svg.append("text").attr({
            //         id: "t" + d.x + "-" + d.y + "-" + i, // Create an id for text so we can select it later for removing on mouseout
            //         x: function() {
            //             return xScale(d.x) - 30;
            //         },
            //         y: function() {
            //             return yScale(d.y) - 15;
            //         }
            //     })
            //     .text(function() {
            //         return [d.x, d.y]; // Value of the text
            //     });
        }
        function handleMouseOut(d, i) { // Add interactivity
            // Use D3 to select element, change color and size
            d3.select(this)
                .style("stroke", "transparent")
                .style("stroke-width", 0);
        }
    </script>
</body>

</html>
